<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="css/main.css" />
  <script src="js/jquery-1.7.1.min.js"></script>
  <script src="js/socket.io.js"></script>
  <script src="js/shortcut.js"></script>
  <script src="js/jquery.upload-1.0.2.min.js"></script>
  <script>
    $(function() {
        var vjsystem = new io.connect('http://' + window.location.host);

        // shortcut setting

        shortcut.add('J', function() {
            vjsystem.emit('KeyEvent', 'PreviousPictureShow');
        });

        shortcut.add('K', function() {
            vjsystem.emit('KeyEvent', 'NextPictureShow');
        });

        shortcut.add('D', function() {
            vjsystem.emit('KeyEvent', 'DestoryPicture');
        });

        shortcut.add('B', function() {
            vjsystem.emit('KeyEvent', 'SetBackground');
        });

        shortcut.add('C', function() {
            vjsystem.emit('KeyEvent', 'ClearBackground');
        });
        // Establish event handlers
        vjsystem.on('disconnect', function() {
            vjsystem.socket.reconnect();
        });

        vjsystem.on('connect', function() {
            
          function run_start()
          {

              vjsystem.emit('Event', 'LoadPicture');
              /*
              ping.emit('ping', encodeDate(new Date()), function(clientDate, serverDate) {
              
              });
              */
          }
          run_start();
      });
      
      vjsystem.on('set_image', function(url) {
          $("#vj_image").attr({'src': url});
      });

      vjsystem.on('set_background_image', function(url) {
          console.log('set_background_image');
          if (url === "") {
            $("body").css('background-image', '');
          } else {
            $("body").css('background-image', 'url(' + url + ')');
          }
        });

      $('#submitButton').click(function() {
        $('input[type=file]').upload('/upload',
            function(res) {
                if (res.status) {
                    vjsystem.emit('EchoPicture', res.path);
                    $('#fileupload').after(
                        $('#fileupload').clone(true));
                    $('#fileupload').remove();
                }
            }, 'json');
      });
    });
</script>
</head>
<body>
    <h1>NotVJS</h1>
     
    <div id="vj_image_wrapper">
        <img src="" id="vj_image"/>
    </div>
    <div id="vj_form">
    <form method="POST" action="/upload" id="fileupload">
        <input type="file" name="filearg"/>
        <input type="button" id="submitButton" />
    </form>
    </div>
</body>
</html>
